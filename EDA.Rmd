---
title: "EDA"
author: "Anna Corcoran, Charlie Konen, Ethan Shang, Kethan Poduri, Daniel Cohen"
date: "2025-11-29"
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE,   # suppress warnings
  message = FALSE,   # suppress messages
  echo = FALSE       # hide code if desired
)
```


```{r}
#| label: libraries

library(ggplot2)
library(dplyr)
library(tidyverse)
```

```{r}
#| label: load-data

brain <- readRDS("data/brain.rds")

```

```{r}
#| label: EDA
genes <- setdiff(names(brain), c("type", "samples"))

# means
gene_means <- sapply(brain[genes], mean, na.rm = TRUE)

# medians
gene_medians <- sapply(brain[genes], median, na.rm = TRUE)
print 
# standard deviation
gene_sd <- sapply(brain[genes], sd, na.rm = TRUE)

# min
gene_min <- sapply(brain[genes], min, na.rm = TRUE)

# max
gene_max <- sapply(brain[genes], max, na.rm = TRUE)


# summary data frame
gene_summary <- data.frame(
  Gene = names(gene_means),
  Mean = gene_means,
  Median = gene_medians,
  SD = gene_sd,
  Min = gene_min,
  Max = gene_max
)
print(gene_summary)
```

```{r}
#| label: histogram-mean
# histograms
# gene means
hist(gene_means,
     breaks = 50,
     main = "Distribution of Gene Means",
     xlab = "Mean Expression",
     col = "lightblue",
     border = "white")
```

```{r}
#| label: histogram-median
# gene medians
hist(gene_medians,
     breaks = 50,
     main = "Distribution of Gene Medians",
     xlab = "Median Expression",
     col = "lightgreen",
     border = "white")
```

```{r}
#| label: histogram-sd   
# standard deviations
hist(gene_sd,
     breaks = 50,
     main = "Distribution of Gene Standard Deviations",
     xlab = "SD",
     col = "lightpink",
     border = "white")
```

```{r}
#| label: top20-hvg
# boxplot of top 20 most variable genes
# Top 20 most variable genes
top_genes <- names(sort(gene_sd, decreasing = TRUE))[1:20]

# Make a bigger plotting window first (optional)
par(mar = c(10, 4, 4, 2) + 0.1)  # bottom margin larger to fit labels
boxplot(brain[top_genes], 
        main = "Top 20 Most Variable Genes", 
        las = 2,       # rotate labels to vertical
        col = "lightcoral",
        cex.axis = 0.7 # shrink label text
)
par(mar = c(5, 4, 4, 2) + 0.1)  # reset margins
```

```{r}
#| label: scatterplot
# scatterplot of gene mean vs sd
plot(gene_means, gene_sd,
     xlab = "Mean Expression",
     ylab = "Standard Deviation",
     main = "Gene Mean vs SD",
     pch = 19, col = rgb(0,0,1,0.5))
```
```{r}
brain %>%
  count(type) %>%
  ggplot(aes(x = type, y = n, fill = type)) +
  geom_col() +
  labs(title = "Sample Counts per Class",
       x = "Brain Tissue Type",
       y = "Count") +
  theme_minimal() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 45, hjust = 1))

```
```{r}

top5000 <- names(sort(gene_sd, decreasing = TRUE))[1:5000]
pca_res <- prcomp(brain[, top5000], scale. = TRUE)
pca_df <- data.frame(
  PC1 = pca_res$x[,1],
  PC2 = pca_res$x[,2],
  PC3 = pca_res$x[,3],
  type = brain$type
)

ggplot(pca_df, aes(x = PC1, y = PC2, color = type)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(title = "PCA of Brain Gene Expression (Top 5,000 Variable Genes)") +
  theme_minimal()

```

```{r}
overall_summary <- data.frame(
  Metric = c("Mean of Means", "Median of Means", "Mean SD", "Median SD"),
  Value = c(mean(gene_means), median(gene_means),
            mean(gene_sd), median(gene_sd))
)
overall_summary

plot(gene_means, gene_sd,
     xlab = "Mean Expression",
     ylab = "Standard Deviation",
     main = "Gene Mean vs SD",
     pch = 19, col = rgb(0,0,1,0.3))


top20_ids <- names(sort(gene_sd, decreasing = TRUE))[1:20]
points(gene_means[top20_ids], gene_sd[top20_ids],
       pch = 19, col = "red")

```

